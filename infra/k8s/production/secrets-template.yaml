# =============================================================================
# Dhanam Secrets Template
# =============================================================================
# INSTRUCTIONS:
# 1. Copy this file to secrets.yaml (NOT tracked in git)
# 2. Fill in the actual credentials
# 3. Apply: kubectl apply -f secrets.yaml
# =============================================================================

apiVersion: v1
kind: Secret
metadata:
  name: dhanam-secrets
  namespace: dhanam
  labels:
    app: dhanam
    component: secrets
type: Opaque
stringData:
  # ==========================================================================
  # Database
  # ==========================================================================
  DATABASE_URL: "<postgresql://user:pass@host:5432/dhanam>"

  # ==========================================================================
  # Redis
  # ==========================================================================
  REDIS_URL: "<redis://host:6379/0>"

  # ==========================================================================
  # Encryption (for provider tokens at rest)
  # ==========================================================================
  ENCRYPTION_KEY: "<32-byte-hex-encryption-key>"

  # ==========================================================================
  # OIDC Client (for Janua SSO)
  # ==========================================================================
  OIDC_CLIENT_ID: "<janua-client-id>"
  OIDC_CLIENT_SECRET: "<janua-client-secret>"

  # ==========================================================================
  # NextAuth (for web frontend)
  # ==========================================================================
  NEXTAUTH_SECRET: "<random-32-char-secret>"

---
# =============================================================================
# Billing Secrets (Stripe MX + Paddle)
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: dhanam-billing-secrets
  namespace: dhanam
  labels:
    app: dhanam
    component: billing
  annotations:
    description: "Hybrid Router billing credentials"
    strategy: "stripe-mx-paddle"
type: Opaque
stringData:
  # ==========================================================================
  # Stripe Mexico
  # ==========================================================================
  # Dashboard: https://dashboard.stripe.com/mx
  STRIPE_MX_PUBLISHABLE_KEY: "<pk_live_xxx>"
  STRIPE_MX_SECRET_KEY: "<sk_live_xxx>"
  STRIPE_MX_WEBHOOK_SECRET: "<whsec_xxx>"

  # ==========================================================================
  # Paddle (Global)
  # ==========================================================================
  # Dashboard: https://vendors.paddle.com
  PADDLE_VENDOR_ID: "<vendor_id>"
  PADDLE_API_KEY: "<paddle_api_key>"
  PADDLE_CLIENT_TOKEN: "<client_token>"
  PADDLE_WEBHOOK_SECRET: "<webhook_secret>"

---
# =============================================================================
# NetworkPolicy: Restrict access to billing secrets
# =============================================================================
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: dhanam-secrets-access
  namespace: dhanam
spec:
  podSelector:
    matchLabels:
      app: dhanam-api
  policyTypes:
    - Ingress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: cloudflare-tunnel
